{% extends 'base.html.twig' %}
{% form_theme form 'form/form_errors.html.twig' %}


{% block title %}
	{{parent()}}
	| Profile
{% endblock %}

{% block body %}
	<div class="base">
		<div class="page">
			<section class="page-title page-title-bg fixed-bg overlay dark-5 padding-top-160 padding-bottom-80">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<h2 class="white-text">Your profile</h2>
							<span class="white-text">Personnal & Professionnal informations</span>
							<ol class="breadcrumb">
								<li>
									<a href="{{ path('app_home') }}">Home</a>
								</li>
								<li class="active">Profile</li>
							</ol>
						</div>
					</div>
				</div>
			</section>
			<section class="gray-bg shdw">
				<div class="container">
					<div class="row">
						{% if percentProfileComplete >= 100 %}
							<div class="score-container">
								<h4>
									<img src="https://i.imgur.com/s9bPVaK.gif" style="height: 80px; width: 201px;">
									&nbsp;
																																																																																																																																																																																				&nbsp; Hooray ! Your profile is complete.
								</h4>
								<div class="c100 p{{percentProfileComplete}} small complete ">
									<span>{{percentProfileComplete}}%</span>
									<div class="slice">
										<div class="bar"></div>
										<div class="fill"></div>
									</div>
								</div>
							</div>
						{% else %}
							<div class="score-container">
								<h4>
									<img src="https://i.imgur.com/s9bPVaK.gif" crossorigin style="height: 80px; width: 201px;">
									&nbsp;
																																																																																																																																																																																				&nbsp;You must complete your profile to apply for offers!
								</h4>
								<div class="c100 p{{percentProfileComplete}} small complete ">
									<span>{{percentProfileComplete}}%</span>
									<div class="slice">
										<div class="bar"></div>
										<div class="fill"></div>
									</div>
								</div>
							</div>
						{% endif %}
					</div>
				</div>
			</section>
			{{ form_start(form, {'attr':{'accept-charset': "UTF-8", 'id': "candidateForm", 'role': 'form', 'data-parsley-validate': "", 'enctype': 'multipart/form-data'}}) }}
			<section class="section-padding">
				<div class="container">
					<div class="row">
						<h3 class="text-extrabold">Your personal informations</h3>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="input-field">
								{{form_widget(form.gender, {'label': false, 'id': "gender"})}}
								<label for="gender" class="active">Gender</label>
							</div>
						</div>
						<div class="clearfix visible-sm"></div>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="input-field">
								{{form_widget(form.firstName, {'label': false, 'id': "first_name", 'attr': {'class': "form-control"}})}}
								<label for="first_name">First name</label>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="input-field">
								{{form_widget(form.lastName, {'label': false, 'id': "last_name", 'attr': {'class': "form-control"}})}}
								<label for="last_name">Last name</label>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="input-field">
								{{form_widget(form.currentLocation, {'label': false, 'id': "current_location"})}}
								<label for="current_location">Current location</label>
							</div>
						</div>
						<div class="col-xs-12 col-sm-8">
							<div class="input-field">
								{{form_widget(form.adress, {'label': false, 'id': "address"})}}
								<label for="address">Address</label>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="row">
								<div class="col-xs-12 col-sm-12">
									<div class="file-field input-field" style="margin-top: 32px;">
										<div class="btn btn-lg primary waves-effect waves-light">
											<span style="display: flex; flex-direction: row;">
												<i class="material-icons" style="margin-right: 10px;">&#xE24D;</i>
												Passport</span>
											{{form_widget(form.passportFile.url, {'label': false, 'id': "passport", 'attr': {'size': "5240000", 'accept': ".pdf,.jpg,.png,.gif,.bmp", }})}}
										</div>
										<div class="existing-file" style="display:none" id="passport-file-name">
											<a href="#!" target="_blank">
												<i class="material-icons">&#xE24D;</i>
												passeport.jpg</a>
										</div>
										<div class="file-path-wrapper" style="display:none" id="passport-file-name-wrapper">
											<input class="file-path validate" type="text" placeholder="Upload your passport" readonly>
										</div>
										<div class="row">
											{{ form_errors(form.passportFile.url) }}
										</div>
									</div>
								</div>
								<div class="col-xs-12 col-sm-12">
									<div class="input-field">
										{{form_widget(form.isPassportValid, {'label': false, 'id': "checkbox-passport"})}}
										<label for="checkbox-passport" id="label-passport">I hold a valid passport.</label>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-8">
							<div class="row">
								<div class="col-xs-12 col-sm-6">
									<div class="input-field">
										{{form_widget(form.country, {'label': false, 'id': "country"})}}
										<label for="country" class="active">Country</label>
									</div>
								</div>
								<div class="col-xs-12 col-sm-6">
									<div class="input-field">
										{{form_widget(form.nationality, {'label': false, 'id': "nationality"})}}
										<label for="nationality">Nationality</label>
									</div>
								</div>
								<div class="col-xs-12 col-sm-6">
									<div class="input-field">
										{{form_widget(form.dateOfBirth, {'label': false, 'id': "birth_date", 'class': 'datepicker'})}}
										<label for="birth_date" class="active">Birthdate</label>
									</div>
								</div>
								<div class="col-xs-12 col-sm-6">
									<div class="input-field">
										{{form_widget(form.placeOfBirth, {'label': false, 'id': "birth_place"})}}
										<label for="birth_place">Birthplace</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row mt-50">
						<h3 class="text-extrabold mb-30">Your professional profile</h3>
						<div class="col-xs-12 col-sm-6">
							<div class="card card-panel passport">
								<div class="file-field input-field">
									<div class="btn btn-lg primary waves-effect waves-light">
										<span style="display: flex; flex-direction: row;">
											<i class="material-icons" style="margin-right: 10px;">insert_photo</i>
											Photo</span>
										{{form_widget(form.profilePicture.url, {'label': false, 'id': "photo", 'attr': {'size': "5240000", 'accept': ".pdf,.jpg,.png,.gif,.bmp", }})}}
									</div>
									<div class="existing-file" id="pic-file-name" style="display:none">
										<a href="#!" target="_blank">
											<i class="material-icons">&#xE24D;</i>
											profil_picture.jpg</a>
									</div>
									<div class="file-path-wrapper" id="pic-file-name-wrapper" style="display:none">
										<input class="file-path validate" type="text" placeholder="Upload your ID photo" readonly>
									</div>
									<div class="row">
										{{ form_errors(form.profilePicture.url) }}
									</div>
								</div>
								<div class="file-field input-field">
									<div class="btn btn-lg primary waves-effect waves-light">
										<span style="display: flex; flex-direction: row;">
											<i class="material-icons" style="margin-right: 10px;">&#xE24D;</i>
											CV</span>
										{{form_widget(form.curriculumVitae.url, {'label': false, 'id': "cv", 'attr': {'size': "5240000", 'accept': ".pdf,.jpg,.png,.gif,.bmp", }})}}
									</div>
									<div class="existing-file" id="cv-file-name" style="display:none">
										<a href="#!" target="_blank">
											<i class="material-icons">&#xE24D;</i>
											CV.pdf</a>
									</div>
									<div class="file-path-wrapper" id="cv-file-name-wrapper" style="display:none">
										<input class="file-path validate" type="text" placeholder="Upload your Curriculum Vitae" readonly>
									</div>
									<div class="row">
										{{ form_errors(form.curriculumVitae.url) }}
									</div>

								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6">
							<div class="col-xs-12 col-sm-12">
								<div class="input-field" style="margin-top: 5px;">
									{{form_widget(form.jobCategory, {'label': false, 'id': "job_sector"})}}
									<label for="job_sector" class="active">Interest in job sector</label>
								</div>
							</div>
							<div class="col-xs-12 col-sm-12">
								<div class="input-field">
									{{form_widget(form.experience, {'label': false, 'id': "experience"})}}
									<label for="experience" class="active">Experience</label>
								</div>
							</div>
							<div class="col-xs-12 col-sm-12">
								<div class="input-field">
									{{form_widget(form.isAvailable, {'label': false, 'id': "checkbox-availability"})}}
									<label for="checkbox-availability" id="label-availability">I'm available for working right now.</label>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-12">
							<div class="input-field">
								{{form_widget(form.shortDescription, {'label': false, 'id': "description", 'attr': {'class': "materialize-textarea", 'cols': "50", 'rows':  "10"}})}}
								<label for="description">Short description for your profile, as well as more personnal informations (e.g. your hobbies/interests ). You can also paste any link you want.</label>
							</div>
						</div>
					</div>
				</div>
			</section>
			<section class="section-padding gray-bg">
				<div class="container">
					<div class="row">
						<div class="col-xs-12 col-sm-12">
							{% if updatePwdErrMsg %}
								<div class="col-md-12 alert alert-danger" role="alert">
									<p>{{updatePwdErrMsg}}</p>
								</div>
							{% endif %}
						</div>
					</div>
					<div class="row">
						<h3 class="text-extrabold">Your Luxury Services account</h3>
						<div class="col-xs-12 col-sm-4">
							<div class="input-field">
								{{ form_widget(form.user.email, {'id': "email"}) }}
								<label for="email">Email</label>
								{{ form_errors(form.user.email) }}
							</div>
						</div>
						<div class="col-xs-12 col-sm-4">
							<div class="input-field">
								{{ form_widget(form.user.password.first, {'id': "password"}) }}
								<label for="password">Change your password here</label>
								{{ form_errors(form.user.password.first) }}
							</div>
						</div>
						<div class="col-xs-12 col-sm-4">
							<div class="input-field">
								{{ form_widget(form.user.password.second, {'id': "password"}) }}
								<label for="password_repeat">Confirm your new password</label>
								{{ form_errors(form.user.password.second) }}
							</div>
						</div>
					</div>
					{{ form_end(form) }}
					<div class="row">
						{{ form_start(deleteAccountForm, {'attr': {'id': 'deleteAccountForm'}})}}
						<div class="col-xs-12 mt-40 mb-80 delete-account">
							{{ form_widget(deleteAccountForm.isActive, {'attr': {'form': "deleteAccountForm"}}) }}
							<a href="#" id="delete-account-btn" class="btn btn-block btn-lg waves-effect waves-light" style="display: flex;">
								<i class="material-icons" style="margin-right: 10px;">&#xE872;</i>Delete my account</a>
						</div>
						{{ form_end(deleteAccountForm) }}
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4">
							<a href="{{path('app_home')}}" class="btn btn-block btn-lg border primary waves-effect waves-light">
								<i class="fa fa-long-arrow-left"></i>
								Back home</a>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-md-offset-4">
							<button id="submit-candidate-form-btn" class="btn btn-block btn-lg gradient secondary waves-effect waves-light">
								<span>
									<strong>UPDATE</strong>
									NOW</span>
							</button>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>
{% endblock %}

{% block bottomjavascript %}
	{{ parent() }}
	<script defer type="text/javascript">

		addEventListener("DOMContentLoaded", (event) => {
let htmlDiv = document.querySelector("html")
htmlDiv.classList.remove("boxshadow")

const delteAccountBtn = document.querySelector('#delete-account-btn')
delteAccountBtn.addEventListener("click", (event) => {
event.preventDefault()
const promptResult = prompt('Please Type \'Delete my account\' to delete your Luxury Services account:')
if (promptResult === 'Delete my account') {
document.getElementById('deleteAccountForm').submit()
}
})

const submitCandidateFormBtn = document.querySelector('#submit-candidate-form-btn')
submitCandidateFormBtn.addEventListener("click", (event) => {
event.preventDefault()
document.getElementById('candidateForm').submit()
})
})

const cv = document.querySelector('#cv')
const photo = document.querySelector('#photo')
const passport = document.querySelector('#passport')

photo.onchange = function () {
	const file = photo.files[0]
	setDisplayNull('#pic-file-name')
	setDisplayNull('#pic-file-name-wrapper')
	setFilename('#pic-file-name', this.value.replace(/.*[\/\\]/, ''), file)
};

cv.onchange = function () {
	const file = cv.files[0]
	setDisplayNull('#cv-file-name')
	setDisplayNull('#cv-file-name-wrapper')
	setFilename('#cv-file-name', this.value.replace(/.*[\/\\]/, ''), file)
};

passport.onchange = function () {
	const file = passport.files[0]
	setDisplayNull('#passport-file-name')
	setDisplayNull('#passport-file-name-wrapper')
	setFilename('#passport-file-name', this.value.replace(/.*[\/\\]/, ''), file)
};

function setDisplayNull(selector) {
	document.querySelector(selector).style.display = null
}

function setFilename(el, filename, file) {
	const parent = document.querySelector(el)
	const aEl = parent.querySelector('a')
	aEl.innerHTML = `<i class="material-icons">&#xE24D;</i>${filename}`
	if (file) {
		aEl.href = URL.createObjectURL(file)
		aEl.download = file.name
	}
}
	</script>
{% endblock %}
